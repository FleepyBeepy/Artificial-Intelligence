<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0058)http://www.gamasutra.com/features/20010912/sterren_pfv.htm -->
<HTML><HEAD><TITLE>Gamasutra - Features - "Terrain Reasoning for 3D Action Games" [09.12.01]</TITLE><!-- #BeginTemplate "/Templates/printer friendly.dwt" --><!-- #BeginEditable "doctitle" --><!-- #EndEditable -->
<META content="text/html; charset=iso-8859-1" http-equiv=Content-Type>
<META content="MSHTML 5.00.3103.1000" name=GENERATOR></HEAD>
<BODY bgColor=#ffffff link=#880000 vLink=#000000><!-- begin main ad tag --><AD 
ClickOver.Page.Value="gama_all"><FONT 
face="Verdana, Arial, Helvetica, sans-serif" size=-2><I><B>Gama Network 
Presents:</B></I></FONT> 
<P align=left><IMG height=60 
src="Terrain Reasoning for 3D Action Games_files/gama2001logo2.gif" 
width=552></P>
<P align=left><IMG height=5 
src="Terrain Reasoning for 3D Action Games_files/99_body_divider.gif" width=445> 
</P>
<P><FONT face="Verdana, Arial, Helvetica, sans-serif" size=+2><!-- #BeginEditable "title" -->
<P align=center><FONT face="Verdana, Arial, Helvetica, sans-serif" 
size=-1><B><FONT size=+2>Terrain Reasoning for 3D Action 
Games</FONT></B></FONT></P><!-- #EndEditable --></FONT><BR><FONT 
face="Arial, Helvetica, sans-serif" size=-1><B><I><FONT 
face="Verdana, Arial, Helvetica, sans-serif">By</FONT> </I></B></FONT><FONT 
face="Verdana, Arial, Helvetica, sans-serif" size=-1 font="undefined"><!-- #BeginEditable "by%20line" --><B><I>William van der 
Sterren</I></B><!-- #EndEditable --></FONT><BR><FONT 
face="Arial, Helvetica, sans-serif" size=-1><B><FONT 
face="Verdana, Arial, Helvetica, sans-serif">Gamasutra</FONT></B></FONT><BR><FONT 
face="Verdana, Arial, Helvetica, sans-serif"><!-- #BeginEditable "issue" --><FONT 
size=-1><I>September 12, 2001<BR></I></FONT><!-- #EndEditable --><FONT 
size=-1><BR><B>URL:</B></FONT><B> </B><!-- #BeginEditable "url" --><FONT 
size=-1><B>http://www.gamasutra.com/20010912/sterren_01.htm</B></FONT><!-- #EndEditable --></FONT>
<P></P><!-- #BeginEditable "main%20content" -->
<P><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1><BR>This paper 
discusses AI terrain reasoning for 3D action games. Terrain reasoning is the AI 
capability to take into account terrain in his planning, decisions, actions and 
communication. Terrain reasoning is a necessity if both AI and terrain play an 
important role in the game. And that often is the case in 3D action 
games.<BR><BR>Level designers spend weeks designing a challenging game world 
with well-thought out battle arenas, multiple access routes, risky approaches to 
highly valued power-ups, defensive strongholds, and neutral 
zones.<BR><BR>However, the traditional action game AI was unaware of all the 
thoughts, efforts and design that went into the level. Instead, he ran around 
almost blind, via shortest paths and sometimes guided by a few static hints from 
the level designer. "Don't ask me, I only work here!"... <BR><BR>This paper 
presents terrain reasoning based on the waypoint graph typically present in 3D 
action games. It discusses terrain reasoning concepts, and how the waypoint 
graph can be reasoned about. The paper discusses and demonstrates the relation 
between tactics and terrain. A case-study shows how to develop off-line and 
in-game reasoning to pick good sniping spots, and how to use game-play feedback 
to create adaptive AI with tactical understanding of the terrain.<BR><BR>A short 
threat prediction example demonstrates one of other ways to reason about the 
terrain. The paper also addresses the major issues in implementing such a 
terrain reasoning system. <BR><BR>But first, let's look at what terrain 
reasoning can offer.<BR><BR></FONT><FONT 
face="Verdana, Arial, Helvetica, sans-serif"><B>Why Terrain 
Reasoning?</B></FONT><FONT face="Verdana, Arial, Helvetica, sans-serif" 
size=-1><BR><BR>Today's action games offer plenty of situations where better AI 
understanding of the terrain would be valuable to the gamer and level designer. 
For example:<BR></FONT></P>
<UL>
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>Recognizing key 
  terrain features and communicating about them.The player issues a "provide 
  suppressive fire" command while pointing to a door in a distant building. 
  Typically, it is not as obvious to the AI as it is to the player that a door 
  is pointed to rather than the wall next to it. But the player expects to hear 
  the AI confirm his order: "roger, will provide fire on that door".</FONT> 
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>Distinguishing 
  between good and bad locations. All locations are not created equal. Some 
  locations are great to ambush other actors, whereas other locations are not. 
  An AI actor who picks the right location for an action simply is more 
  convincing</FONT> 
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>Interpreting 
  location based performance. After being lured into the same narrow tunnel to 
  receive a rocket for the 3rd time in a row, it would be great if the AI would 
  recognize the tunnel as a bad place to be. The AI should adapt its tactics 
  accordingly, instead of trying to dodge the rocket without the space to do 
  so.</FONT> 
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>Automating part 
  of the level annotation. The level designer favorite job probably isn't 
  manually editing dozens of waypoints to tell the AI "camp here", "avoid this 
  location", "here's some cover". An AI capable of automatically annotating the 
  level itself will save the level designer time. And AI provided feedback on 
  its interpretation of the terrain might be welcome as well. Automated AI 
  interpretation not only is useful for the professional level designer, but 
  even more for the amateur level designer who is less familiar with the needs 
  of the AI.</FONT> 
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>Including the 
  terrain in tactical considerations. Few things are as exciting as engaging a 
  squad of AI actors who coordinate their actions, and alternate suppression 
  fire with grenade lobbing. Part of that excitement disappears if the same 
  squad applies those same tactics at a less suitable location: the AI should 
  understand that attacking from, for example, an elevator is different than 
  from a warehouse full of crates.</FONT> </LI></UL><FONT 
face="Verdana, Arial, Helvetica, sans-serif" size=-1>Terrain reasoning may be an 
important ingredient to address the issues, but it cannot do so without 
enhancements in other parts of the AI, such as the planner, state machines, 
combat rules, etc. These other parts of the AI have been receiving plenty of 
attention in literature.<BR><BR></FONT><FONT 
face="Verdana, Arial, Helvetica, sans-serif"><B>Ingredients and 
Concepts</B></FONT><FONT face="Verdana, Arial, Helvetica, sans-serif" 
size=-1><BR><BR>Terrain reasoning AI subsystem consists of the following 
components:<BR>
<UL>
  <LI>terrain representation; and 
  <LI>functions to construct, query and manipulate that terrain representation. 
  </LI></UL></FONT>
<P><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>The amount of 
terrain in an action game makes it infeasible to efficiently handle the terrain 
in raw geometry format, or by means of a rule bases or neural nets: both the 
size and the geometric detail present in a level prevent this.<BR><BR>For those 
reasons, terrain reasoning should be addressed with custom solutions, tuned for 
the specific AI needs and level characteristics of the game.<BR><BR>A popular 
and custom means to describe terrain are waypoints (and similar concepts such as 
cells or grids - see [Reece], [Snook]). Waypoints represent the subset of the 
terrain accessible to the player and AI. The connections between these waypoints 
denote viable movement. And the graph created by the waypoints and their 
inter-connections expresses the valid paths.<BR><BR>Often, these waypoints are 
annotated with the presence of nearby power ups. Sometimes, the waypoints are 
part of more abstract concepts like areas and portals. Thus, waypoints are a 
handy and versatile terrain representation. Nevertheless, the AI typically 
ignores to reason about them (except for the occasional path 
finding).<BR><BR>The remainder of this paper discusses how to reason about 
terrain based on the waypoint graph. While the ideas result from developing 
tactical squad and individual AI for tactical action game, the concepts apply to 
a wide range of action games.<BR><BR><B>Waypoint Graphs</B><BR>Waypoint graphs 
convey a lot more information than just the shortest path from A to B. For 
example, the waypoint graph in Figure 1 below suggests terrain that is composed 
of three rooms, connected by a few hallways. </FONT></P>
<TABLE align=center border=0 width=30>
  <TBODY>
  <TR>
    <TD><IMG height=128 
      src="Terrain Reasoning for 3D Action Games_files/image002.gif" vspace=10 
      width=200></TD>
    <TD><IMG height=150 
      src="Terrain Reasoning for 3D Action Games_files/image003.png" 
    width=200></TD></TR>
  <TR>
    <TD colSpan=2>
      <DIV align=center><FONT face="Verdana, Arial, Helvetica, sans-serif" 
      size=-1><B><FONT face="Verdana, Arial, Helvetica, sans-serif" 
      size=-1>Waypoints expressing the shape of a level (left), and waypoints 
      in-game (right)</FONT></B></FONT></DIV></TD></TR></TBODY></TABLE>
<P><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>All waypoints 
together not only communicate the shape of the accessible terrain. If enhanced 
with line-of-sight and line-of-fire information, waypoint graphs can be used to 
express many ingredients that make up tactics.<BR><BR><B>Picking Tactics 
Apart</B><BR>Tactics in 3D action games frequently deal with the terrain. For 
example, in deathmatch games, the winner typically is the one able to seize and 
hold the location where the most powerful weapon, item or power-up respawns 
(such as the "quad damage").<BR><BR>In 'capture-the-flag' (CTF) team games, the 
team able to identify and defend the bottleneck areas near the home base will 
stand a good chance. In a tactical shooter, the squad that manages to reach the 
objective via an concealed approach will have good chances of surprising the 
enemy.<BR><BR>In all these examples, terrain plays a big role. Actually, the 
relation is often big enough to enable tactics ingredients to be expressed in 
terms of waypoints and their relations.<BR><BR>Look at the game terrain, pick 
two locations, and ask the question: Why is one a better (or worse) location 
than the other for a specific tactic?<BR><BR><B>Relating Tactics, Terrain and 
Waypoints</B><BR>In deathmatch games, p1 often is better if it is closer to a 
key power up than p2, or if enables to the actor to see and lay fire on power up 
locations. "Closer to" can be measured in travel time along the shortest path, 
and the presence of a line of sight between two waypoints often equals the 
availability of the line of fire between the corresponding locations.<BR><BR>The 
bottleneck area in CTF is typically on the access route to the base. Access 
routes can be identified from the number of paths to the base that pass through 
that area. The bottleneck area also offers little cover from observation and 
incoming rockets. Expressed in waypoints, that means that waypoints in or near 
the bottleneck area all have a line-of-sight and line-of-fire from a number of 
waypoints in the base area.<BR><BR>A concealed approach consists of a path to 
the destination that cannot be observed for long periods from locations near the 
destination. In other words, solely a small number of path waypoints can be 
observed from waypoints near the destination, and it never involves a long 
string of consecutive waypoints. Note that the quality of a tactical expression 
in terms of waypoints depends on the density of waypoints: the denser the 
waypoint graph covering the terrain, the more accurate the expression (see also 
section 6.1).<BR><BR>The expressions also make assumptions about the effects of 
weapon, and player movement abilities.<BR><BR><B>Waypoint 
Calculations</B><BR>The direct relation between tactical concepts and the 
waypoint graph enables us to turn these concepts into computable properties. For 
meaningful results, those computations should resemble the human tactical 
interpretation.<BR><BR>A waypoint has four different kinds of characteristics 
that all should be taken into account:<BR></FONT></P><FONT 
face="Verdana, Arial, Helvetica, sans-serif" size=-1>
<UL>
  <LI>The local environment. Waypoints describe, for example, how dark the 
  location is, which types of movement are required (crouching, swimming, using 
  a ladder), whether a door or button entity is present. 
  <LI>The membership(s) of higher-level terrain concepts. Waypoints may be 
  grouped to represent terrain concepts such as a room, a lake, or the blue 
  team's base. 
  <LI>The relations with other waypoints. Waypoints have relations with other 
  waypoints: is there a valid line-of-sight, how long does it take to get from 
  one waypoint to the other. 
  <LI>The focus (in the relations with other waypoints). A waypoint whose 
  relations, such as line-of-sight or easy access, are clustered primarily in a 
  single narrow direction has focus in that direction. </LI></UL></FONT>
<TABLE align=center border=0 width=30>
  <TBODY>
  <TR>
    <TD><IMG height=122 
      src="Terrain Reasoning for 3D Action Games_files/image006.gif" 
    width=575></TD></TR>
  <TR>
    <TD>
      <DIV align=center><FONT face="Verdana, Arial, Helvetica, sans-serif" 
      size=-1><B><FONT face="Verdana, Arial, Helvetica, sans-serif" 
      size=-1>Waypoint characteristics: local environment, group membership, 
      relations and focus</FONT></B></FONT></DIV></TD></TR></TBODY></TABLE><FONT 
face="Verdana, Arial, Helvetica, sans-serif" size=-1><BR>Of all the four 
characteristics, focus, is the most complex to grasp. The following case studies 
will illustrate why it is needed.<BR><BR></FONT><FONT 
face="Verdana, Arial, Helvetica, sans-serif"><B>Analyzing Terrain and Adapting 
Tactics</B></FONT><FONT face="Verdana, Arial, Helvetica, sans-serif" 
size=-1><BR><BR>Terrain reasoning based on waypoint graphs, its value, and the 
concepts introduced here are best explained via an example. <BR><BR>This section 
discusses a concrete case, 'picking good sniping spots', in detail and 
illustrates how to translate tactics such as "sniping" to waypoint graph 
properties, how to create an algorithm that turns these properties into a 
waypoint sniping suitability score, how to improve the pre-computed sniping 
scores with sniping performance feedback collected in-game (thus learning), and 
how to adapt the algorithm to include game play experience in its tactical 
considerations (thus adapting to game tactics).<BR><BR><B>Problem: Picking Good 
Sniping Spots</B><BR>Assume the following scenario (in a tactical 3D first 
person action game): <BR>
<BLOCKQUOTE><I>The player points to a building some one hundred meters in 
  front of him, and summons the nearby AI actor: "get into position to snipe 
  that building". The AI establishes the direction to the building.<BR><BR>The 
  AI determines all waypoints that are within 2 seconds distance of him. He 
  quickly ranks these spots for "sniping" suitability towards the target 
  building. For the most promising spots, he checks if a clear line of fire is 
  available.<BR><BR>Once a candidate spot has been found, the AI checks if it 
  good enough for sniping purposes. The AI then reports back to the player 
  whether he is able to execute the instruction. If so, he moves into 
  position.</I></BLOCKQUOTE></FONT>
<P><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>This example 
focuses on computing the waypoint's suitability for sniping.</FONT></P>
<P><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1><B>The 
Terrain</B><BR>A rather simple and small level serves to illustrate the terrain 
reasoning (whereas the reasoning can deal with any terrain size). The level 
consists of:</FONT></P>
<UL>
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>Two buildings 
  on opposite ends of the terrain, each having two windows with a view to the 
  bridge, and a rotating door</FONT> 
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>A creek 
  separating the two sides</FONT> 
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>A bridge, 
  providing a fast way to cross the creek, and offering some cover (half-height 
  walls)</FONT> 
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>Two stairs, 
  enabling players to leave the creek. Both stairs provide some cover 
  (half-height walls)</FONT> 
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>Two full-height 
  walls, providing additional cover.</FONT> </LI></UL>
<P><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>In this example, 
assume that the AI sniper is in the northwest corner of the level, and is 
instructed to snipe towards the building in the northeast.</FONT></P>
<TABLE align=center border=0 width=30>
  <TBODY>
  <TR>
    <TD><IMG height=356 
      src="Terrain Reasoning for 3D Action Games_files/image007.png" 
    width=475></TD></TR>
  <TR>
    <TD>
      <DIV align=center><FONT face="Verdana, Arial, Helvetica, sans-serif" 
      size=-1><B><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>A 
      simple, symmetric level, to demonstrate reasoning about 
      sniping</FONT></B></FONT></DIV></TD></TR></TBODY></TABLE>
<P><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1><BR>The terrain is 
covered by some odd 480 waypoints.</FONT></P><FONT 
face="Verdana, Arial, Helvetica, sans-serif" size=-1><B>Sniping Tactics and Good 
Sniping Spots</B><BR>The suitability of a position for sniping depends on many 
qualities. Many of these qualities are easily identified when trying to describe 
the differences between an obviously good and an obviously bad sniping position. 
<BR><BR>The following qualities make for a good sniper spot in a tactical 
shooter game: <BR>
<BLOCKQUOTE>A. The sniper is inconspicuous at the spot<BR>B. The sniper can 
  overlook many distant locations from the spot<BR>C. The spot is hard to reach 
  from the overlooked locations<BR>D. In the direct surroundings of the spot, 
  the sniper can find cover from threats at overlooked locations<BR>E. The 
  overlooked locations do not provide nearby cover from observation and attack 
  by the sniper (at his spot)<BR>F. The spot overlooks many key locations (such 
  as doors, windows)<BR>G. Threats cannot easily approach the spot without being 
  observed<BR>H. The spot has focus, that is, it offers a great view in one 
  single direction, in combination with one or more protected flanks<BR>I. The 
  spot allows the sniper to move freely, without requiring special movement 
  skills, and without having to deal with obstacles such as 
doors</BLOCKQUOTE><B>Relating Sniping Spot Qualities and Terrain</B><BR>These 
sniping spot qualities are easily related to the following waypoint graph 
properties. For example, "the sniper is inconspicuous at the spot" can be 
expressed using a waypoint property: the (average) light level at the waypoint 
is below a minimum value.</FONT> 
<P><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>A directional 
property (reflecting a relation between waypoints), "in the direct surroundings 
of the spot, the sniper can find cover from threats at overlooked locations," 
can be translated to "For all waypoints overlooked from the sniper spot 
waypoint: given a presumed threat at the overlooked waypoint, an easily reached 
waypoint that offers cover from such a threat is available near the sniper 
waypoint"</FONT></P>
<P><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>Even a complex 
property like focus can be easily tranlated: "The spot has focus, that is, it 
offers a great view in one single direction, in combination with one or more 
protected flanks" can be translated to "the ratio of waypoints visible in one 
direction vs. waypoints visible in other directions"<BR><BR>The following table 
lists the terrain properties used to express the sniping spot 
qualities:</FONT></P>
<TABLE align=center border=0 width=30>
  <TBODY>
  <TR>
    <TD><IMG height=273 
      src="Terrain Reasoning for 3D Action Games_files/image012.gif" 
    width=614></TD></TR>
  <TR>
    <TD>
      <DIV align=center><FONT face="Verdana, Arial, Helvetica, sans-serif" 
      size=-1><B><FONT face="Verdana, Arial, Helvetica, sans-serif" 
      size=-1>Tactical properties for a sniping spot, and related terrain 
      properties</FONT></B></FONT></DIV></TD></TR></TBODY></TABLE>
<P><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1><BR></FONT><FONT 
face="Verdana, Arial, Helvetica, sans-serif" size=-1><B>Sniping Suitability: The 
Formula</B> <BR>With the sniping spot qualities expressed in terms of waypoint 
graph properties, a sniping spot suitability score can be computed, for each 
waypoint and every direction, as follows: </FONT></P><FONT 
face="Verdana, Arial, Helvetica, sans-serif" size=-1>
<BLOCKQUOTE>
  <P><I>&nbsp;&nbsp;&nbsp;sniping spot quality</I> (<I>w</I> ,<I>d</I> ) 
  =<BR>&nbsp;&nbsp;&nbsp;<SPAN style="FONT-FAMILY: Symbol">S 
  </SPAN><I>properties</I> ( <I>w </I>) <BR>+ <I>focus</I> ( <I>d </I>) <SPAN 
  style="FONT-FAMILY: Symbol"><SPAN>´</SPAN></SPAN> <SPAN 
  style="FONT-FAMILY: Symbol">S</SPAN> <I>directional properties</I> ( <I>w</I> 
  , <I>w&#8217;</I> ),<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for all waypoints <I>w&#8217;</I> 
  in direction <I>d</I> from <I>w</I> </P></BLOCKQUOTE>
<P class=MsoFooter style="MARGIN-BOTTOM: 0pt">A directional property, such as, 
&#8220;b: overlooking many distant locations &#8220; is computed as 
follows:</P><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <SPAN 
style="FONT-FAMILY: ZapfDingbats; FONT-SIZE: 7pt"><SPAN 
style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</SPAN></SPAN><I>Overlooking distant locations </I>(<I>w</I> ,<I>d</I> ) = 
<BR><BR>
<TABLE align=center border=0 cellPadding=0 cellSpacing=0>
  <TBODY>
  <TR>
    <TD vAlign=top width=474>
      <P class=MsoFooter style="MARGIN: 3pt 0in"><I><FONT 
      face="Verdana, Arial, Helvetica, sans-serif" size=-1>k</FONT></I><FONT 
      face="Verdana, Arial, Helvetica, sans-serif" size=-1>&nbsp; <SPAN 
      style="FONT-FAMILY: Symbol"><SPAN>´</SPAN></SPAN> <SPAN 
      style="FONT-FAMILY: Symbol">S</SPAN> ( <I>line-of-sight-line-of-fire</I> 
      (<I>w</I> , <I>w&#8217;</I> ) <SPAN 
      style="FONT-FAMILY: Symbol"><SPAN>´</SPAN></SPAN> <I>fardistance 
      </I>(<I>w</I> , <I>w&#8217;</I> )&nbsp; 
      )<BR>_________________________________________________________ 
    </FONT></P></TD></TR>
  <TR>
    <TD vAlign=top width=474>
      <P class=MsoFooter style="MARGIN: 3pt 0in"><FONT 
      face="Verdana, Arial, Helvetica, sans-serif" size=-1><BR># waypoints 
      <I>w&#8217;&#8217;</I> with a <I>line-of-sight-line-of-fire </I>(<I>w</I> , <I>w&#8217;&#8217;</I> 
      ) &gt; 0</FONT></P></TD></TR></TBODY></TABLE>
<P class=MsoNormal 
style="MARGIN-BOTTOM: 0pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
for all waypoints <I>w&#8217;, w&#8217;&#8217; </I>&nbsp;in direction <I>d</I> from <I>w</I> </P>
<P class=MsoFooter style="MARGIN-BOTTOM: 0pt">with<SPAN 
style="FONT-FAMILY: ZapfDingbats; FONT-SIZE: 7pt"><SPAN 
style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp; 
</SPAN></SPAN><I>line-of-sight-line-of-fire</I> ( ) and <I>fardistance </I>( 
)<I> </I>returning values in [0..1]</P>
<P class=MsoFooter style="MARGIN-BOTTOM: 0pt">And focus is computed (assuming 45 
degrees directions), for example, as:</P>
<P class=NormalBullet1 style="MARGIN-LEFT: 0.25in"><SPAN 
style="FONT-FAMILY: ZapfDingbats; FONT-SIZE: 7pt"><SPAN 
style="FONT: 7pt 'Times New Roman'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</SPAN></SPAN><I>focus</I> (<I>w</I> ,<I>d</I> ) = </P>
<TABLE align=center border=0 cellPadding=0 cellSpacing=0>
  <TBODY>
  <TR>
    <TD vAlign=top width=504>
      <P class=MsoFooter style="MARGIN: 3pt 0in"><FONT 
      face="Verdana, Arial, Helvetica, sans-serif" size=-1>3 x <I>value</I> ( 
      <I>w</I>, <I>d</I> ) + 1 x <I>value </I>( <I>w</I>, <I>d</I> + 45<SPAN 
      style="FONT-FAMILY: Symbol"><SPAN>°</SPAN></SPAN>) + 1 x <I>value </I>( 
      <I>w</I>, <I>d</I> - 45<SPAN 
      style="FONT-FAMILY: Symbol"><SPAN>°</SPAN></SPAN>)<BR>_________________________________________________________</FONT></P></TD></TR>
  <TR>
    <TD vAlign=top width=504>
      <P class=MsoFooter style="MARGIN: 3pt 0in"><FONT 
      face="Verdana, Arial, Helvetica, sans-serif" size=-1><SPAN 
      style="FONT-FAMILY: Symbol"><BR>S </SPAN>value (w, d + <SPAN 
      style="FONT-FAMILY: Symbol">a</SPAN>) for all <SPAN 
      style="FONT-FAMILY: Symbol">a</SPAN> in {-135<SPAN 
      style="FONT-FAMILY: Symbol"><SPAN>°</SPAN></SPAN>, -90<SPAN 
      style="FONT-FAMILY: Symbol"><SPAN>°</SPAN></SPAN>, +90<SPAN 
      style="FONT-FAMILY: Symbol"><SPAN>°</SPAN></SPAN>, +135<SPAN 
      style="FONT-FAMILY: Symbol"><SPAN>°</SPAN></SPAN>, +180<SPAN 
      style="FONT-FAMILY: Symbol"><SPAN>°</SPAN></SPAN>} 
  </FONT></P></TD></TR></TBODY></TABLE>
<P class=NormalBullet1 style="MARGIN-LEFT: 0in; TEXT-INDENT: 0in">with<SPAN 
style="FONT-FAMILY: ZapfDingbats; FONT-SIZE: 7pt"><SPAN 
style="FONT: 7pt 'Times New Roman'">&nbsp; </SPAN></SPAN><I>value</I> ( 
<I>w</I>, <I>d</I> ) = # waypoints <I>w&#8217;&#8217;</I> with a 
<I>line-of-sight-line-of-fire </I>(<I>w</I> , <I>w&#8217;&#8217;</I> ) &gt; 0<BR>for all 
waypoints <I>w&#8217;, w&#8217;&#8217; </I>&nbsp;in direction <I>d</I> from <I>w<BR></I><FONT 
face="Verdana, Arial, Helvetica, sans-serif" size=-1><BR>Focus here is the ratio 
of forward interactions versus non-forward directions.The role of focus is best 
illustrated using the example terrain. Positions that have a strong eastbound 
focus are:</FONT></P></FONT>
<UL>
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1><FONT 
  face="Verdana, Arial, Helvetica, sans-serif" size=-1>the positions at the 
  western border, because they only have relations with waypoints to their west, 
  and typically with a lot them;</FONT></FONT> 
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1><FONT 
  face="Verdana, Arial, Helvetica, sans-serif" size=-1>the rooms in the 
  southwestern building, and the small alley south of that building have a very 
  strong focus, because their flanks are protected;</FONT></FONT> 
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>the positions 
  in the northwest, west of the full height wall, the positions on the northern 
  stairs from the creek, and the positions in western side of the creek also 
  have a good eastbound focus, because their back (to the west) is 
  covered.</FONT> </LI></UL>
<TABLE align=center border=0 width=30>
  <TBODY>
  <TR>
    <TD><IMG height=225 
      src="Terrain Reasoning for 3D Action Games_files/image013.png" 
    width=300></TD>
    <TD><IMG height=225 
      src="Terrain Reasoning for 3D Action Games_files/image016.jpg" 
    width=300></TD></TR>
  <TR>
    <TD colSpan=2>
      <DIV align=center><FONT face="Verdana, Arial, Helvetica, sans-serif" 
      size=-1><B><FONT face="Verdana, Arial, Helvetica, sans-serif" 
      size=-1>Left: East-oriented focus (darker color is higher focus) for all 
      locations, illustrated as a top view, along with terrain feature overlay 
      Right: AI computed Sniping Spot preferences (darker is better) in the 
      eastward direction, using static level data 
  only</FONT></B></FONT></DIV></TD></TR></TBODY></TABLE>
<P><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1><BR></FONT><FONT 
face="Verdana, Arial, Helvetica, sans-serif" size=-1><B>Ranking Sniping Spots 
using Static Info</B><BR>The sniping spot quality formula, computed for each 
waypoint, in the east direction, generates the result as illustrated in Figure 
5, right image, above. The results demonstrate that using the waypoint graph 
(and assumptions about game physics and weapon characteristics), the AI really 
can identify good sniping spots. It identifies as good spots the rooms and 
windows in southwest building, the western edge of the level, the northern 
stairs near the creek, and the spot between the northern stairs wall and the 
bridge wall.<BR><BR>Thus the AI, in the scenario sketched, is able to pick a 
good sniping spot from a list of automatically ranked sniping locations.Having 
an algorithm that identifies great sniping spots using just the annotated 
waypoint graph has several advantages. The AI no longer is dependent on the 
level designer to annotate terrain. The level designer himself can generate and 
inspect the AI's understanding of the terrain, which assists him in properly 
employing AI in the level.<BR><BR>However, it is also a disadvantage to use only 
these few inputs because locations not properly represented by a nearby waypoint 
are ignored and actual game play is ignored.<BR><BR>The first problem is easily 
addressed by adding more waypoints at and near key locations: with more 
waypoints, the AI is less likely not to detect a position offering cover. 
<BR>The second problem shows in the rating of sniper spots on the western creek 
bank: these positions receive a rather high rating because they overlook spots 
in the creek from which it is hard to avoid the sniper. However, in most game 
scenarios, most activity will not occur in that creek. Consequently, the sniper 
spots on the creek bank are overrated.<BR><BR>Luckily, the lack of game play 
input is not only easily addressed, but also creates a great 
opportunity.<BR><B><BR>Using In-Game Sniping Feedback to Rate Sniping 
Spots</B><BR>To improve the pre-computed sniper spot ratings, the AI needs to 
capture and analyze game play, and adjust the ratings accordingly. This sounds 
more complex than it really is, and even better, at can be done on the fly, at 
virtually no (CPU) costs.<BR><BR>Capturing and analyzing the required game play 
data for this case is done by </FONT><FONT 
face="Verdana, Arial, Helvetica, sans-serif" size=-1>recording, at every way 
point, the time spent by the AI or player while static at that position and with 
sniping weapon active, the amount of damage caused by the sniping weapon from 
that position, and the amount of damage taken when sniping at that 
position.<BR><BR>After every game round or mission, aggregate this "experience" 
as follows:<BR><BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<I> sniping experience at ( w, 
d ) =<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;player sniping time in direction ( 
w, d ) + AI sniping time in direction ( w, d ) <BR>&nbsp;&nbsp;&nbsp;+ player 
directional damage issued ( w, d ) + AI directional damage issued ( w, d ) 
<BR>&nbsp;&nbsp;&nbsp;- player directional damage taken ( w, d ) - AI 
directional damage taken ( w, d )</I><BR><BR>and adjust the pre-computed 
waypoint sniping rankings with the 
experience:<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<I>sniping quality ( w, d ) 
=<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;precomputed sniping quality ( w, d ) + 
sniping experience at ( w, d )</I></FONT><FONT 
face="Verdana, Arial, Helvetica, sans-serif" size=-1><BR><BR>Collecting the game 
play data takes negligible time, especially since most games already determine 
the nearest waypoint for every actor at every game tick (for navigation 
purposes). Processing also takes little time, and typically can be done when 
presenting an intermission screen.<BR><BR>Because the AI can adapt its sniping 
spot rankings 'on-the-fly', it will display varying and adaptive sniping 
behavior. For this example, some 40 game rounds were run, with one or two 
snipers defending the western building, and three or four attackers storming 
that building from the east side of the level. The player, randomly, acted as a 
defending sniper or one of the attackers. The figures below illustrate the 
"sniping experience data" collected in-game, and the updated waypoint sniping 
ratings (in the east direction):</FONT></P>
<TABLE align=center border=0 width=30>
  <TBODY>
  <TR>
    <TD><IMG height=206 
      src="Terrain Reasoning for 3D Action Games_files/image018.jpg" 
    width=275></TD>
    <TD><IMG height=206 
      src="Terrain Reasoning for 3D Action Games_files/image020.jpg" 
    width=275></TD></TR>
  <TR>
    <TD colSpan=2>
      <DIV align=center><FONT face="Verdana, Arial, Helvetica, sans-serif" 
      size=-1><B><FONT face="Verdana, Arial, Helvetica, sans-serif" 
      size=-1>Left: Waypoint sniping experience data (non-directional, darker is 
      better)<BR>Right: Eastward sniping ratings adjusted with the experience 
      (darker is better)</FONT></B></FONT></DIV></TD></TR></TBODY></TABLE>
<P><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1><BR></FONT><FONT 
face="Verdana, Arial, Helvetica, sans-serif" size=-1>Note that the sniping 
experience data in the images above (left) largely corresponds with (and thus 
confirms) the sniper ratings computed from the waypoint graph. However, the 
experience data also emphasizes several highly successful sniper spots over 
other potential sniper spots.<BR><BR>Adjusting the waypoint sniping ratings 
results in new ratings. These ratings show a decreased importance for the 
southwestern creek bank, and increased importance for a few northwestern spots 
partially covered by the full height wall there.<BR><BR><B>Better Tactical 
Understanding From Game Play Experience</B><BR>Further improvements of the 
sniping ratings are possible using the game play data. In the previous section, 
the sniping spot ratings have been adjusted by more or less copying "best 
sniping practices", without giving the data gathered further thought. Giving the 
data some thought, that is, using the game play data in our reasoning is exactly 
what needs to be done to improve the sniping ratings. <BR><BR>Game play does not 
occur evenly across the map. Some locations are more frequently visited than 
other locations. And sniping spots overlooking many of these "traffic" locations 
thus are more important. Again, it is easy and cheap to record actor and player 
movement per waypoint. The formula for sniping rating needs to be extended with 
yet another factor, the ability of the sniper to overlook much of the traffic 
(preferably at some distance from its spot, because then the sniper has an 
advantage).</FONT></P>
<TABLE align=center border=0 width=30>
  <TBODY>
  <TR>
    <TD><IMG height=206 
      src="Terrain Reasoning for 3D Action Games_files/image022.jpg" 
    width=275></TD>
    <TD><IMG height=206 
      src="Terrain Reasoning for 3D Action Games_files/image024.jpg" 
    width=275></TD></TR>
  <TR>
    <TD colSpan=2>
      <DIV align=center><FONT face="Verdana, Arial, Helvetica, sans-serif" 
      size=-1><B><FONT face="Verdana, Arial, Helvetica, sans-serif" 
      size=-1>Left: Traffic data per location (non-directional, darker is more 
      traffic)<BR>Right: Sniping ratings now also taking into account traffic 
      and sniping experience (darker is 
  better)</FONT></B></FONT></DIV></TD></TR></TBODY></TABLE>
<P><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1><BR></FONT><FONT 
face="Verdana, Arial, Helvetica, sans-serif" size=-1>Re-running the algorithm, 
now taking into account both sniping experience, and traffic data results in the 
following output as is shown above (right).<BR><BR>The new results again show 
reduced sniping ratings of the spots on the southwestern bank near the creek. 
They also show increased ratings for the whole western edge of the map (because 
these positions overlook many traffic spots). <BR><BR><B>Processing 
Steps</B><BR>The AI need for the waypoint sniping ratings, as discussed in the 
scenario above, has been addressed with:</FONT></P>
<UL>
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>tactics based 
  algorithm to rate sniping spots using the waypoint graph;</FONT> 
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>an on-the-fly 
  procedure to adapt the sniping ratings to game-play feedback;</FONT> 
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>(optionally), a 
  re-run of the algorithm to put more tactical understanding of the game play in 
  the ratings</FONT> </LI></UL>
<TABLE align=center border=0 width=30>
  <TBODY>
  <TR>
    <TD><IMG height=365 
      src="Terrain Reasoning for 3D Action Games_files/image026.gif" 
    width=537></TD></TR>
  <TR>
    <TD>
      <DIV align=center><FONT face="Verdana, Arial, Helvetica, sans-serif" 
      size=-1><B><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>The 
      terrain analysis cycle, with pre-game and in-game 
      processing</FONT></B></FONT></DIV></TD></TR></TBODY></TABLE>
<P><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>The in-game memory 
consumption can be as small as two tables containing, for each waypoint and each 
relevant direction, the sniping rating and player and AI activities 
respectively. The in-game CPU consumption consists of tracking player and AI 
activity per waypoint, and a brief computation to adjust sniping ratings 
(typically done when presenting an intermission screen). To preprocess a level, 
the memory and CPU requirements are more demanding. The tables for shortest 
paths, line-of-sight, line-of-fire easily consume a few MB, and the algorithm 
takes a few tens of seconds to execute.<BR><BR>There are several alternatives to 
create good waypoint sniper rankings, as is shown in Figure 8 above.The approach 
presented enables the game developer to ship his game with an "experienced" AI 
that has gained some tactical understanding of the game's levels.Optionally, the 
gamer can be allowed to run the algorithm using on his game play data, so the AI 
adapt to his style of playing.<BR><BR><B>Similar Terrain Reasoning 
Applications</B><BR>A problem similar to picking sniper positions is finding 
appropriate ambush positions. The ambush position typically is hidden from 
observation in all but a few directions. The ambush position typically overlooks 
a number of nearby locations, thus providing targets little time to respond. The 
direction of traffic near the ambush position typically is perpendicular to or 
away from the attack direction.<BR><BR>Again, these properties can be mapped 
onto waypoint related properties. For ambush positions, it is also simple to 
capture 'ambush' related game play data, and use that to adjust ambush ratings 
on-the-fly, or with a re-run of the algorithm.<BR><BR>Another problem that is 
very similar is identifying good positions to position sentry guns.<BR>A more 
generic waypoint 'combat suitability' rating is also valuable. Such a rating 
will help the AI distinguish between threats that occupy strong or weak 
positions. If the game AI implements flocking behavior, that waypoint 'combat 
suitability' rating can be used to stimulate tactical movement. <BR><BR>In a 
flocking algorithm, squad members determine their position based on attracting 
forces (for example, stay near the team members) and repulsing forces (stay away 
from walls, do not get too close to team members). Often, tactical 
considerations are ignored. By using the generic 'combat' rating as additional 
force (attracting or repulsing the squad member), concepts such as nearby cover, 
good overview, and flank protection can be handled as part of the flocking. As a 
result, the squad will be more likely to move along walls than to move in the 
open.<BR>In combination with areas and portals, the combat rating of areas and 
portals can be determined. To do so, for each area, the combat ratings for 
waypoints are determined using solely the interactions with other waypoints 
outside the area. This enables the AI to detect strongholds.<BR></FONT><FONT 
face="Verdana, Arial, Helvetica, sans-serif"><B><BR>Other Terrain Reasoning 
Applications</B></FONT><FONT face="Verdana, Arial, Helvetica, sans-serif" 
size=-1><BR><BR>Terrain reasoning has many other applications, for example 
dealing with dynamic situations. The following threat prediction case 
illustrates the use of waypoint graph based reasoning for dynamic 
situations.<BR><BR><B>Predicting Out-of-sight Threats </B><BR>Image the 
following scenario (with an AI actor, on defense, having spotted a 
threat):<BR>Upon seeing the AI actor, the threat turns and moves to the right, 
away from the window and out of sight. The AI actor stays alert...<BR><BR>To be 
a useful team member or challenging opponent, the AI should understand where 
threats are likely to appear and where threats are likely to move to. Though it 
is often infeasible to fully model the presumed motives and behavior of threats, 
it is possible to do a good job using the terrain representation. <BR><BR>The 
following two-step, waypoint graph based approach works quite well. First 
predict the threat's position using:</FONT></P>
<UL>
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>the threat's 
  last observed position and movement;</FONT> 
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>the viable 
  paths in the threat's surroundings;</FONT> 
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>the (absence 
  of) lines-of-sight to the threat's presumed position.</FONT> </LI></UL>
<P><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>Typically, the 
threat's position is extrapolated, under the assumption that the threat 
continues in the same direction and with the same speed. The resulting position 
is tested against both the paths feasible, and the line-of-sight. For example, 
the threat will not move through walls, and in the waypoint graph, the absence 
of path indicates that. Similarly, if the AI does not see the threat at a 
predicted location that is in full view, the extrapolation is known to be 
incorrect. In these cases, the presumed threat position can be corrected to 
reflect a (more) likely location, for example the last valid extrapolated 
location.<BR><BR>Second, the AI needs to decide where to aim for. If the AI 
cannot fire through obstacles, it solely has to consider the visible locations 
in the immediate surroundings of the presumed threat position. One simple way to 
pick a likely location for the threat to reappear (and thus a location to aim 
for), is to construct the shortest path from the presumed threat position to the 
AI actor. The first location on that path that is within view of the AI, is a 
good location to aim for. The shorter the time the threat needs to travel to 
that location, the more likely<BR>If the threat's likely reappear location is 
quite close to the threat's presumed location, the AI might consider to employ 
suppression fire or launch a rocket towards that location.<BR><BR><B>Terrain 
Reasoning for Dynamic Situations</B><BR>A large number of dynamic situations can 
be interpreted efficiently using terrain reasoning, including locating nearby 
cover, planning concealed paths, moving in formation, assessment of enemy 
positions, etc.<BR><BR></FONT><FONT face="Verdana, Arial, Helvetica, sans-serif" 
size=-1>Even non-trivial reasoning, such as determining the value of spending a 
hand grenade to attack or flush out a threat, can be done efficiently provided 
the data structures are designed to support such a query 
(Sterren).<BR><BR></FONT><FONT 
face="Verdana, Arial, Helvetica, sans-serif"><B>Implementing Terrain 
Reasoning</B></FONT><FONT face="Verdana, Arial, Helvetica, sans-serif" 
size=-1><BR><BR>Terrain reasoning means reasoning about tens of thousands of 
polygons, and millions of inter-waypoint relations. Implementing terrain 
reasoning thus is a matter of carefully analyzing the AI requirements, the 
resource constraints, making trade-offs, and executing some 
experiments.<BR><BR>This section briefly discusses the most important trade-offs 
to be made:</FONT></P>
<UL>
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>waypoint 
  resolution, accuracy and performance</FONT> 
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>CPU load, 
  lookup tables, and memory consumption</FONT> 
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>Dynamics and 
  pre-processing</FONT> </LI></UL>
<P><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1><B>Waypoint 
Resolution, Accuracy and Performance</B><BR>Waypoints (and similar AI navigation 
aids) represent the accessible game terrain. Many action games have their AI use 
as few waypoints as possible, because:</FONT></P>
<UL>
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>fewer waypoints 
  mean less work to the level designer (to place them); </FONT>
  <LI><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>fewer waypoints 
  mean faster pathfinding and smaller shortest path lookup tables</FONT> 
</LI></UL>
<P><FONT face="Verdana, Arial, Helvetica, sans-serif" size=-1>However, fewer 
waypoints mean also a coarser representation of the game terrain: each waypoint 
(on average) describes a larger part of the terrain, and the line-of-sight and 
travel time relations becomes less accurate.<BR><BR>The waypoint density 
required to sufficiently describe the terrain depends on the game design and AI 
needs. For games featuring lethal weapons ("single shot kills"), slow movement, 
many obstacles, and lack of respawns, the terrain representation should describe 
as many covered and concealed spots. This typically translates to a high 
waypoint density. In games featuring respawns, fast movement, and weaker 
weapons, a low waypoint density suffices, since terrain details are less 
important (but the tactics still may be terrain driven, because of power-up and 
objectives positions). Note that algorithm such as the one used for identifying 
good sniping spots assumes a more or less uniform distribution of waypoints 
across the terrain.<BR><BR><B>CPU Load, Lookup Tables, and Memory 
Consumption</B><BR>Some terrain-related properties such as paths, and a bouncing 
grenade trajectory take considerable time to compute. Other properties such as 
lines-of-sight are inspected so frequently that in total they consume a good 
amount of CPU.<BR><BR>Now consider the following simple AI query to locate 
nearby cover from a number of threats: <BR>Given three threats that have line of 
fire to the AI actor, is there a spot within 3 seconds distance that provides 
cover?<BR><BR>To determine the result, the AI needs to construct numerous paths 
and perform a good number of ray traces (taking into account different actor 
postures, such as sitting and prone).<BR>Today's CPUs and game engines handle in 
the order of 3,000 A* path searches per second, and 50,000 trace lines per 
second, depending on level size and geometry complexity. Given an AI budget of 
10 percent, and 10 AI ticks per second, the AI is allowed some 15 path searches 
and 250 trace lines per tick, for all its actors (typically 4 to 30 of them), 
and as its sole activity.<BR><BR>Storing part of the computations and looking up 
the (intermediate) results typically is three orders of magnitude faster for 
path finding, and two orders of magnitude faster for trace lines. Using lookup 
tables thus frees up CPU time for more advanced AI or faster 
graphics.<BR><BR>However, lookup tables may consume a good amount of memory. 
Especially for waypoint-pair relations, such as paths and line-of-sight, the 
straightforward matrix implementation has <I>O(N x N) </I>space complexity. For 
<I>N</I> <SPAN 
style="FONT-FAMILY: Symbol; mso-ascii-font-family: Arial; mso-hansi-font-family: Arial; mso-char-type: symbol; mso-symbol-font-family: Symbol"><SPAN 
style="mso-char-type: symbol; mso-symbol-font-family: Symbol">³</SPAN></SPAN> 
1000, these lookup tables really start consuming megabytes.<BR>For path lookup, 
a hierarchical or multi-level path structure in combination with a cache for the 
most recently referred to paths (and travel times) offers a smaller footprint 
while still being very efficient.<BR><BR>The average waypoint sees only a small 
subset of all other waypoints. In that case, the line-of-sight matrix can be 
flattened: per waypoint, record solely the waypoints actually seen by that 
waypoint, and the waypoints able to see that waypoint.<BR><BR>Another concept 
that helps selecting the right content for look up tables is the so-called "time 
horizon". Most of the AI decisions, especially under the resource demanding 
"combat" conditions, have a limited scope. The game world is so dynamic that 
planning beyond a horizon of one to three seconds (depending on the game) has 
little value. <BR><BR>The AI queries therefor limit themselves to the 
surroundings accessible within the time horizon (and upon arriving there, they 
will decide again). A per waypoint look up table that contains the info for all 
waypoints within that time horizon will be very efficient without being 
large.<BR><BR><B>Dynamics and Pre-Processing</B><BR>Pre-processing the terrain 
can significantly off-load the in-game AI (as is the case with pre-computing 
sniping spots). However, the game terrain is not completely static. Dynamic 
environment such as doors, vehicles, elevators, destructible walls, will change 
the paths, lines-of-sight, etc. <BR><BR>Dynamic environment does not necessarily 
invalidate pre-processed terrain information. Whether a distant door is open or 
closed does not really affect the value of a sniping spot. However, a nearby 
door being closed typically does invalidate a sniping spot (and is checked for 
in the sniping scenario).<BR><BR>Apart from checking for changes in the 
environment, the AI can also try to patch the pre-computed terrain description. 
The lines-of-sight affected by a door can be pre-computed, and the changes can 
be applied on the fly when the door changes state. Another option is to have a 
background threat slowly update the information.<BR><BR><B>Implementing 
Reinforcement Learning</B><BR>Waypoint based reinforcement learning is easy to 
implement. Just capture the AI or player activity local to the waypoint, 
determine whether it is positive or negative feedback for the intended task, and 
adjust the waypoint value accordingly.<BR><BR>To create an AI that adapts 
quickly and tactically to the player's tricks, pay some attention to issues like 
attaching more significance to feedback from player activity than from AI 
activity because the player will be more creative, and have a better tactical 
understanding of the game and terrain. The player activity should be valued more 
than the combined AI activities. <BR><BR>This policy also prevents the AI from 
honing into its own flaws (for example, the AI repeatedly and unsuccessfully 
assaulting an area because the area is known for the many frags scored 
there).<BR><BR>P eriodically, level all values to be more responsive to changes 
in tactics. After re-computing sniping spots using game play data, the player 
might see changes in the AI sniping and adapt his tactics. To be more responsive 
to changes in the player's tactics, the aggregated game play activity values 
should be leveled. Using a function such as log or sqrt, this can be done while 
preserving the ordering.<BR><BR><B>Visualization and Feedback</B><BR>The 
waypoint based terrain reasoning uses an approximation of the terrain, and 
heuristics to interpret that approximation. Consequently, implementing this kind 
of terrain reasoning requires tuning. <BR><BR>To efficiently develop and tune a 
terrain reasoning algorithm, the algorithm is best created incrementally, and 
using feedback from visualizing its results. Luckily, it is easy to visualize 
and interpret terrain and terrain properties. Preferably, the results are 
visualized as an overlay in the rendered 3D world. For tuning, an export 
facility to comma separated files and a spread sheet package are 
recommended.<BR><BR></FONT><FONT 
face="Verdana, Arial, Helvetica, sans-serif"><B>Summary</B></FONT><FONT 
face="Verdana, Arial, Helvetica, sans-serif" size=-1><BR>Terrain reasoning is 
the AI's ability to include terrain and related concepts such cover, travel 
time, areas in its plans, decisions, actions and communication. Notably in 
action games where AI and terrain play a big role, effective terrain reasoning 
results in a richer game AI. Terrain reasoning involves a terrain 
representation, and algorithms to create, manipulate and query that 
representation. Waypoint graphs, until now primarily used for navigation, are 
demonstrated to be a powerful means for terrain reasoning. <BR><BR>Many action 
game tactics use the terrain. These tactics then can be related to properties of 
the waypoint graph. With formulas to express these waypoint graph properties, 
the tactical concepts such as sniping spots, ambush locations, and strongholds 
can be computed and identified by the AI.<BR><BR>The reasoning about tactical 
concepts is easily extended to include player and AI game behavior local to the 
waypoint. This game activity data enables the AI to adapt its tactics to actual 
game play. Adaptation occurs because of re-enforcement learning, and because of 
improved understanding of the role that various locations play in the 
game.<BR><BR>The waypoint based terrain reasoning can be used in-game, for 
example to interpret threat positions and select the appropriate tactics. This 
kind of terrain reasoning can also be used to pre-process terrain in order to 
off-load and assist the run-time AI.<BR></FONT><FONT 
face="Verdana, Arial, Helvetica, sans-serif"><B><BR>Acknowledgements</B></FONT><FONT 
face="Verdana, Arial, Helvetica, sans-serif" size=-1><BR><BR>Jan Paul van 
Waveren (id software), Doug Reece (SAIC), and the numerous talented bot 
developers in the Quake, Half-Life, and Unreal bot communities for valuable 
discussions. <BR>The Action Quake II community for their help in turning that 
"mod" into a custom designed tactics testbed for AI experiments. 
<BR><BR></FONT><FONT face="Verdana, Arial, Helvetica, sans-serif"><B>References 
and Suggested Reading</B></FONT><FONT 
face="Verdana, Arial, Helvetica, sans-serif" size=-1><BR><BR>Campbell, C.E., 
McCulley, G., "Terrain Reasoning Challenges in the CCTT Dynamic Environment" in 
the 5th Annual Conference on AI, Simulation, and Planning in High Autonomy 
Systems, IEEE, 1994<BR><BR>Laird, J.E., "It knows what you're going to do: 
Adding anticipation to a Quakebot" in AAAI 2001 Spring Symposium Series: 
Artificial Intelligence and Interactive Entertainment, March 2000, AAAI 
Technical Report SS-00-02 <BR><BR>Pottinger, D.C., "Terrain Analysis in Realtime 
Strategy Games" in Proceedings of Computer Game Developer Conference, 
2000<BR><BR>Reece, D., Krauss, M., Dumanoir, P., "Tactical Movement Planning for 
Individual Combatants", in Proceedings of the 9th Conference on Computer 
Generated Forces and Behavioral Representation, 2000<BR><BR>Reich, A.J., "An 
Efficient Representation of Spatial Data For Terrain Reasoning By Computer 
Generated Forces", in Proceedings of the ELECSIM95, SCS, 1995<BR><BR>Snook, 
Greg, "Simplified 3D Movement and Pathfinding Using Navigation Meshes" in 
<I>Game Programming Gems I,</I> Mark DeLoura (ed.), Charles River Media, 
2000<BR><BR>van der Sterren, W, AI for Tactical Grenade Handling, <A 
href="http://www.cgf/?ai.com/docs/grenadehandling.pdf" 
target=_blank>http://www.cgf/?ai.com/docs/grenadehandling.pdf</A> 
2000</FONT><BR></P>
<P><FONT face="Verdana, Arial, Helvetica, sans-serif"><FONT 
size=-1><B>http://www.gamasutra.com/20010912/sterren_01.htm</B></FONT></FONT> 
</P><!-- #EndEditable -->
<P><FONT face="Arial, Helvetica, sans-serif" size=-1><I><FONT 
face="Verdana, Arial, Helvetica, sans-serif">Copyright © 2000-2001 CMP Media 
Inc. All rights 
reserved.</FONT></I></FONT></P><!-- #EndTemplate --></BODY></HTML>
